<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Efterlysninger</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Efterlysninger_files/libs/clipboard/clipboard.min.js"></script>
<script src="Efterlysninger_files/libs/quarto-html/quarto.js"></script>
<script src="Efterlysninger_files/libs/quarto-html/popper.min.js"></script>
<script src="Efterlysninger_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Efterlysninger_files/libs/quarto-html/anchor.min.js"></script>
<link href="Efterlysninger_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Efterlysninger_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Efterlysninger_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Efterlysninger_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Efterlysninger_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Efterlysninger</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Denne notebook beskriver vores forsøg på at undersøge og berige vores datasæt med efterlysninger. Datasættet er på forhånd skabt gennem et klassifikationsmodel, der har gennemgået alle tekster fra Politiets Efterretninger og fundet personefterlysningerne. Denne model har en høj præcision og genkaldelse, så datasættet indeholder stort set kun faktiske efterlysninger. I de første skridt fjerner vi dog enkelte aflysninger og andre tekster, ved at filtrere datasættet på senest identificere overskrift, således at kun tekster fra rubrikkerne “Efterlysninger” og “Andre meddelelser” kommer med i den endelige version.</p>
<p>Vores læsninger er guidet af nogle overordnede betragtninger om genren:</p>
<ol type="1">
<li><p>Den er gammel - med et dybt spor ind i 1700-tallets trykte mediers historie, hvor efterlysninger var en tilbagevendende genre. Vi tænker dermed dele af efterlysningernes sprog som gammelt - også ældre end den politiinstution, der her tager det i brug.</p></li>
<li><p>Den indeholder givetvis oplysninger om mange forskellige mennesker, hvilket vi gerne vil kunne bruge, når materialet navigeres.</p></li>
<li><p>Den har haft flere overlappende funktioner - herunder også fremlysning, hvor det efterlyste er oplysninger om en person, der faktisk er fundet (f.eks. død).</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(umap)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(word2vec)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doc2vec)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"Positive_forudsigelser.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Text <span class="sc">!=</span> seneste_overskrift) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(seneste_overskrift, <span class="st">"lysning|eddelelse"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(seneste_overskrift, <span class="st">"(A|a)flys"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_to_lower</span>(Text)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>predicted_label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="simple-materiale-specifikke-sprogmodeller" class="level2">
<h2 class="anchored" data-anchor-id="simple-materiale-specifikke-sprogmodeller">Simple materiale-specifikke sprogmodeller</h2>
<p>For at bearbejde materiale ønsker vi at skabe vektorrepræsentationer af det. Og vi ønsker os, at disse repræsentationer er så materialespecifikke som muligt. Selvom der findes gode og moderne embedding-modeller, skaber vi i stedet vores egne, for at få en repræsentation, der afspejler det konkrete materiale og dets tendenser.</p>
<p>Første skridt er at tokenisere datasættet og træne en word2vec-model. Vi tester den til sidst ved at søge på et søgeord.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>toks <span class="ot">&lt;-</span> df<span class="sc">$</span>text <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">as.list</span>()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>w2v <span class="ot">&lt;-</span> <span class="fu">word2vec</span>(toks, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"skip-gram"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">dim =</span> <span class="dv">150</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">hs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">lr =</span> <span class="fl">0.05</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter =</span> <span class="dv">15</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">threads =</span> <span class="dv">4</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">sample =</span> <span class="fl">0.001</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">min_count =</span> <span class="dv">3</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">window =</span> <span class="dv">5</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>søgeords_naboer <span class="ot">&lt;-</span> <span class="fu">predict</span>(w2v, <span class="st">"vagabond"</span>, <span class="at">type =</span> <span class="st">"nearest"</span>, <span class="at">top_n =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dette skaber en oversigt, der ser således ud:</p>
<p><img src="billedfiler/Skærmbillede%202025-11-05%20kl.%2014.24.46.png" class="img-fluid"></p>
<p>Dette kan hjælpe os til at finde slægtskaber imellem ord eller guide vores søgning ved at foreslå pseudonymer. Det bliver relevant senere.</p>
<p>Vi bruger imidlertid først disse embeddings som basis for en paragraph2vec-model. Denne forudsiger teksters ord med udgangspunkt i en dokument-vektor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>embeddings <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(w2v)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_prepped <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> Text,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">doc_id =</span> tekst_id,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_sub</span>(text, <span class="dv">1</span>, <span class="dv">5000</span>), <span class="co"># nok ikke nødvendigt her, men godt at huske...</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">tolower</span>(text),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>, <span class="st">""</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">" </span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">gsub</span>(<span class="st">"[[:space:]]+"</span>, <span class="st">" "</span>, text),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">text =</span> <span class="fu">trimws</span>(text)) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(text, doc_id)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>df_prepped <span class="ot">&lt;-</span> df_prepped <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="co"># Modellen kan ikke lide NA</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>doc_vec_model <span class="ot">&lt;-</span> <span class="fu">paragraph2vec</span>(df_prepped, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">threads =</span> <span class="dv">5</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                               <span class="at">hs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                               <span class="at">iter =</span> <span class="dv">15</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sample =</span> <span class="fl">0.001</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                               <span class="at">dim =</span> <span class="dv">150</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">min_count =</span> <span class="dv">3</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                               <span class="at">embeddings =</span> embeddings)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">write.paragraph2vec</span>(doc_vec_model, <span class="st">"extraordinaire_vecs_150.bin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vores model skaber en repræsentation af hver tekst i 150 dimensioner, men med henblik på visualisering og klyngeidentifikation, reducerer vi antallet af dimensioner med henblik på at identificere klynger af tekster. Dette gør vi med umap, der laver det materialespecifikke embeddings-space om til en grafstruktur, hvor tekster knyttes til deres nærmeste naboer - altså de tekster, der har lignende vektorrepræsentationer. Fordelene ved dette er blandt andet, at det gør det muligt, at visualisere teksters placering i klynger, der vil fremstå som fortætninger i det nye to-dimensionelle rum.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>samlet_emb_docs <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(doc_vec_model, <span class="at">type =</span> <span class="st">"docs"</span>) <span class="co"># tjek, at den har matchende antal rækker med df</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>umap_embeddings <span class="ot">&lt;-</span> <span class="fu">umap</span>(<span class="fu">as.matrix</span>(samlet_emb_docs),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_neighbors =</span> <span class="dv">25</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">preserve.seed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="st">"cosine"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">min_dist =</span> <span class="fl">0.05</span>, <span class="co"># default-værdien er 0.1</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>umap_koordinater <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(umap_embeddings<span class="sc">$</span>layout)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(umap_koordinater)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2), <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vi kan dermed kigge på vores embeddingsspace, i dets reducerede format:</p>
<p><img src="billedfiler/Skærmbillede%202025-11-05%20kl.%2014.25.40.png" class="img-fluid"></p>
<p>Vi ser en god adskillelse i et meningsfuldt antal klumper. Derfor går vi videre med denne version. Bemærk, at der også er nogle små klumper, der falder ud af visualiserings ramme, fordi de er meget særegne og derfor ikke forbundet til den øvrige graf.</p>
<p>Med henblik på at gøre fortætninger i materialet til basis for klynger, benytter vi hdbscan - en clustering-algoritme, der netop leder efter fortætninger. Vi forsøger at ramme nogle indstillinger, hvor antallet af identificerede clusters svarer nogenlunde til, hvad vi ser på grafen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>hdbscan_resultater <span class="ot">&lt;-</span> <span class="fu">hdbscan</span>(<span class="fu">as.matrix</span>(umap_embeddings<span class="sc">$</span>layout),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">minPts =</span> <span class="dv">100</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cluster_selection_epsilon =</span> <span class="fl">0.2</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(hdbscan_resultater<span class="sc">$</span>cluster)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">clusters =</span> <span class="st">`</span><span class="at">hdbscan_resultater$cluster</span><span class="st">`</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(clusters <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clusters) <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">centroid_x =</span> <span class="fu">mean</span>(V1), <span class="at">centroid_y =</span> <span class="fu">mean</span>(V2))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(clusters, tekst_id) <span class="sc">%&gt;%</span> writexl<span class="sc">::</span><span class="fu">write_xlsx</span>(<span class="st">"clusters.xlsx"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df3) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> V1, </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> V2, </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colour =</span> <span class="fu">as.character</span>(clusters)), </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">filter</span>(df3, <span class="fu">str_detect</span>(Text, <span class="fu">regex</span>(<span class="st">"hjemmet"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> centroids, </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> centroid_x, </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> centroid_y, </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label =</span> clusters), </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">7.5</span>, <span class="fl">7.5</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">7.5</span>, <span class="fl">7.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="billedfiler/Skærmbillede%202025-11-05%20kl.%2014.27.30.png" class="img-fluid"></p>
<p>De røde prikker er outliers ifølge clustering-algoritmen. De sorte prikker matcher et søgeord, i dette tilfælde “hjemmet” - som vi ofte finder italesat i forbindelse med bekymring for børn, der har forladt deres hjem.</p>
<p>For at få en fornemmelse for, hvad klyngerne handler om, kigger vi på term-frequency inverse-document-frequency. En score, der i denne kontekst kommer til at repræsentere hvilke ord, der er højfrekvente i den enkelte klynge, men typisk ikke er det i det resterende korpus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>klynger_ord <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clusters) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">samlet_text =</span> <span class="fu">paste</span>(Text, <span class="at">collapse =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(ord, samlet_text) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(clusters, ord)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>klynger_top_tf_idf <span class="ot">&lt;-</span> klynger_ord <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(ord, clusters, n) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(clusters) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(tf_idf, <span class="at">n =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(særlige<span class="at">_ord =</span> <span class="fu">paste</span>(ord, <span class="at">collapse =</span> <span class="st">"; "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(clusters <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>klynger_top_tf_idf<span class="sc">$</span>særlige_ord</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code> [1] "udskrivningskreds; kreds; bekjendte; lægd; militær; værnepligtig; indkaldt; rekrut; indkaldte; sidst; sidstbekjendte; værnepligtige; tjeneste; opholdsted; sal; 1ste; stuen; efternævnte; 1861; 1863; opholdssted; 1865; født; 1860; arbejdskarl; g; frederiksberg; maskinarbeider; tjenestekarl; opvarter"                                               
 [2] "vaabenfrakke; kompagniet; kompagni; afdeling; bataillons; komp; menig; felthue; rekrut; afdelingen; kaserne; pioner; uniform; sabelbajonet; ingeniørregimentets; batteri; absenteret; kirsais; emblem; kasernen; citadellet; lægd; feltkappe; sølvgadens; batl; sabel; artilleribataillons; garnisonen; fortet; udskrivningskreds"                        
 [3] "kjole; shavl; boutikstyveri; hovedtørklæde; overstykke; slør; kurv; sort; kyse; butikstyveri; armen; straahat; kaabe; gaden; aar; nederdel; fruentimmer; børn; dameklædt; bomuldskjole; hun; graat; bedrageri; hat; havelock; slag; navngivet; forklæde; besætning; jaket"                                                                                
 [4] "liget; fandtes; afdøde; vandet; underbenklæder; skjønnes; fundet; druknet; henligger; opløst; funden; overbord; liighuset; ligets; udfor; skjønnedes; langebro; forraadnet; seler; mandsperson; undertrøie; hængt; afdødes; uldne; vævede; henligget; ligget; mrk; ubekjendt; hvo; hængning; lighuset"                                                    
 [5] "hjemmet; drengen; forulykket; kaskjet; sort; sal; udebleven; lære; vendt; bortgaaet; trøje; hjem; rundpuldet; aar; skotsk; tilbage; strømper; fjedersko; tilstand; vest; senere; vinterfrakke; stuen; aflivet; sit; kapsko; sindsforvirret; siden; fuldskjæg; udstaaende"                                                                                 
 [6] "kjole; hjemmet; pigen; hun; shavl; pigebarnet; vilhelmine; christine; bomuldskjole; overstykke; sort; nederdel; straahat; kondition; tjenestepige; aflivet; hospital; besætning; sal; marie; kaabe; ulden; fjer; jaket; caroline; hovedtørklæde; anna; bortgaaet; udebleven; tilstand"                                                                    
 [7] "alimentanter; bekjendte; fleskum; sidst; kommune; fattigudvalget; herred; opholdsted; 1889; tjenestekarl; herredsfogden; 1888; kjellerup; politi; herreder; sogneraad; tjente; fl; født; opholdssted; fæstningsværkerne; sidstbekjendte; kjær; juni; lemvig; hvetbo; flyttede; opholdt; april; marts"                                                     
 [8] "bøde; politikasse; afsoning; betaling; simp; mangel; hensat; fængsel; afsoningsordre; skylder; henhold; ordre; afkrævet; bøden; stiftamts; affordret; resolution; bøder; kjøbstads; simpelt; politikassen; statskassen; vedtagen; afsonet; hensatte; bødens; amtets; foranstaltet; dages; skylde"                                                         
 [9] "idag; mandsperson; koster; stjaalet; kaskjet; læderfodtøj; frakke; sort; stiaalet; uhr; rundpuldet; efterlyste; hat; aar; rundpullet; talte; vinterfrakke; skjæg; have; mistænkt; beskrives; kindskjæg; træsko; flad; mørke; overskjæg; støvler; ca; hele; højde; intet; søndre"                                                                          
[10] "mandspersoner; drenge; klædte; anden; alderen; to; rundpuldede; ene; iførte; velklædte; rundpuldet; jakker; filthatte; læderfodtøj; høiere; kaskjet; byggede; kaskjetter; indbrud; aar; sort; mindre; begge; middelhøje; hatte; sværere; grovt; hat; middelhøjde; højde"                                                                                  
[11] "mandsperson; rundpuldet; læderfodtøj; sort; uterlighed; aar; lignede; grovt; dreng; højde; vinterfrakke; skjæg; kvistkammer; navngivet; middelhøjde; indbrud; hat; ordentlig; kaskjet; intet; bedrageri; opførelse; overskjæg; kvistkamre; kjøkkener; frakke; ca; jakkeklædning; fuldskjæg; kvistkammertyveri"                                            
[12] "belønning; politiøvrigheden; udlovet; maal; dollars; paagribelse; statsanklageren; statsadvokaten; paagribelsen; thlr; frankfurt; thaler; bortrømt; underslæb; fod; landretten; stadsfiskalen; efterlyses; wien; pande; øjenbryn; rmk; postassistent; bank; fallit; gylden; bremen; allg; politipræsidiet; flensborg"                                     
[13] "mandsperson; kaskjet; middelhøi; frakke; stortrøie; buxer; aar; sort; middelhøide; bedrageri; skjæg; høide; beenklæder; hat; bluse; intet; arbeidsmand; rundpullet; omtrent; høi; mørk; do; magert; lyse; talte; flad; halstørklæde; ansigt; blank; siderne"                                                                                              
[14] "kaskjet; mandsperson; tyveriet; iii; frakke; middelhøi; stortrøie; bakkenbarter; arbeidsmand; kasket; bedrageri; sort; aar; flad; kjøbenh; fortyveriet; ii; barter; efterl; høide; skjæg; middelhøide; iv; stat; lyse; intet; høi; militair; øine; hat"                                                                                                   
[15] "bedrageri; hertil; sort; politi; aar; hyresvig; rundpuldet; protokollen; født; kaskjet; overskjæg; skrædersvend; skjæg; middelhøjde; intet; hyrebesvigelse; højde; vinterfrakke; hat; frakke; staden; stortrøje; fuldskjæg; mist; do; læderfodtøj; mistænkelige; rundpullet; henhører; skomagersvend"                                                     
[16] "kjole; shavl; tjenestepige; marie; overstykke; pigen; christine; hun; sort; vilhelmine; slør; caroline; emilie; straahat; besætning; hertil; jaket; nederdel; cathinka; bedrageri; anna; frederikke; hovedtørklæde; kaabe; theodora; skjørt; havelock; bomuldskjole; jacobine; karen"                                                                     
[17] "hun; kjole; skjørt; hovedtørklæde; laante; pigen; shavl; besætning; frynser; kirstine; hendes; uldent; forklæde; underskjørt; marie; sort; laant; bomuldsforklæde; kaabe; medtagende; hende; silkekyse; hvergarns; herredsfogden; tjeneste; bomuldskjole; gjenstande; frastiaalet; tørklæde; nederdel"                                                    
[18] "deserteret; værnepligtig; new; sørullen; york; deserterede; newcastle; liverpool; værnepligtige; antwerpen; hull; lægdsrullen; rullen; skibet; lov; skonnerten; udbedes; tiltalt; skibsfører; rotterdam; helbefaren; opholdsted; rømning; london; begjært; tiltales; rømmet; 1866; forhyret; optagne"                                                     
[19] "gjentages; efterlysningen; anm; endnu; tilføjende; rettelig; bemærkning; herved; medd; rettet; aflyses; antruffen; da; kfr; ommeldte; efterlysning; efterlyste; efterlysningerne; angaaende; meddeles; paany; fulde; hedder; modtagen; herreder; forbindelse; hun; identisk; erindring; efterspurgte"                                                     
[20] "tvangspas; opmærksomhed; politiøvrighedernes; hjemskreven; arbejdsløs; udstaaet; politiøvrigheders; forsørgelseskommune; straf; ernærende; løsgængeri; driver; hjemsendt; henleder; ankommen; betleri; meldt; løsgænger; strejfe; subsistentsmidler; ham; henledes; forsørgelsested; hjemskrevet; afgik; betler; fyenske; passet; paalæg; fattiggaard"    
[21] "idag; koster; søndre; afleveres; birks; sort; rundpuldet; frakke; tjenestekarl; bedrageri; kaskjet; arbejdskarl; læderfodtøj; uhr; aar; stjaalet; svensk; overskjæg; højde; anh; kontor; oftere; stortrøje; straffet; skjæg; medtjener; født; amts; hat; do"                                                                                              
[22] "løsgængertilhold; overtraadt; bortstjaalet; polititilhold; kaskjet; fattiggaard; sort; arbejdsanstalt; derved; frakke; herredsfogden; brystlomme; tilladelse; uldsokker; fattiggaarden; fattiglem; romertal; tvistlærreds; transporteres; udv; anstaltens; foret; mrk; indv; knapper; aar; buxer; bortgangen; kontor; buckskins"                          
[23] "kost; affordret; betaling; gjæld; beløbet; mangel; øre; betaler; beløb; betale; afkrævet; logis; skyld; skyldige; betales; betalingen; hemmelig; hemmeligt; efterladende; afhørt; beløbene; skyldte; telegrafisk; skylder; forskud; strax; saafremt; ialt; affordrede; betalt"                                                                            
[24] "mønstring; værnepligtig; møde; udeblivelse; værnepligtige; lægdet; bataillon; indkaldt; lægd; mønstringen; batl; vedtegning; kreds; indkaldte; indkaldelsesordre; sessionen; værnepligtslovens; flytning; ikjendt; fængsel; simp; paalæg; tiltales; bataillons; udskrivningskreds; forfald; dikteret; 427; timers; rigtighed"                             
[25] "dom; kriminal; politirets; fængsel; anset; anseet; x; finde; politirettens; straf; extraretsdom; idømt; politiretsdom; brød; vand; bøde; v; højesteretsdom; ikjendt; simp; forkyndelse; tiltalte; dommens; strls; dømt; straffens; hun; execution; dages; unddraget"                                                                                      
[26] "anledning; alimentationsbidrags; alimentationssag; opholder; alimentationsbidrag; jndfordring; forsørgelsessag; beder; forkyndt; udbeder; oplysning; jnddrivelse; inddrivelse; meddelt; paternitetssag; opholdsted; nuværende; fortiden; ønskes; omløben; herredsfogden; nuhavende; sag; kriminel; resterende; blive; dom; indfordring; bødes; forklaring"    </code></pre>
<p>Nogle klynger synes at handle om bestemte typer mennesker, imens andre handler om måder at beskrive på.</p>
<p>Vi kigger på deres udvikling over tid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(clusters <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(å<span class="at">r =</span> <span class="fu">year</span>(dato))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df4) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> år, <span class="at">fill =</span> <span class="fu">as.factor</span>(clusters)), <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> år, <span class="at">fill =</span> <span class="fu">as.factor</span>(clusters), <span class="at">label =</span> clusters),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">stat =</span> <span class="st">"count"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"NULL"</span>) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"andel"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="billedfiler/Skærmbillede%202025-11-05%20kl.%2014.29.11.png" class="img-fluid"></p>
<p>Det er tydeligt, at mediet først finder en form efter et par år. Derefter er mønsteret ret stabilt, men domineres imod slutningen af en bredere vifte af små kategorier.</p>
</section>
<section id="superviseret-læring-via-en-eksisterende-sprogmodel" class="level2">
<h2 class="anchored" data-anchor-id="superviseret-læring-via-en-eksisterende-sprogmodel">Superviseret læring via en eksisterende sprogmodel</h2>
<p>Udover dette usuperviserede workflow lavede vi også en superviseret kategorisering. Vi samplede 1500 tilfældige tekster og besluttede os for fem kategorier, vi ville tagge efter:</p>
<ol type="1">
<li>Omtaler efterlysningen en efterlyst kvinde? Såfremt annoncen omtaler efterlyste af begge køn tagges denne også her.</li>
<li>Omtaler efterlysningen en udlænding? Vi definerede i denne kontekst alle, der ikke havde nationalstaten Danmark som ophav. Sprogmarkører (f.eks. “taler tysk og gebrokkent dansk”) blev også benyttet til denne tagging.</li>
<li>Indeholder efterlysningen et signalement? Her regnede vi alt, der kunne gøre det muligt at forestille sig personens udseende og fremtoning, inklusiv specifikke taleegenskaber, som signalement.</li>
<li>Udtrykker efterlysningen bekymring? Vi havde identificeret, hvordan nogle efterlysninger ikke italesatte en overtrædelse, men blot en forsvinden ofte fra hjemmet. I en del af disse efterlysninger spekuleres der desuden i, at der kan være sket personen en ulykke eller sågar at personen kan være til fare for sig selv.</li>
<li>Er efterlysningen en fremlysning? Dvs. en efterlysning, hvor personen faktisk er tilstede, men alligevel beskrives på tilsvarende måde, fordi der er brug for at indhente oplysninger om vedkommende. Vi valgte også at tagge annoncer om afdøde med dette tag.</li>
</ol>
<p>Vi trænede herefter setfit-modeller med disse data. Dette foregik i python med versioner af følger script:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasets <span class="im">import</span> Dataset</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> setfit <span class="im">import</span> SetFitModel, SetFitTrainer</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, f1_score, precision_score, recall_score</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"efterlysninger_1500.csv"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Udlænding?"</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">"Udlænding?"</span>], errors<span class="op">=</span><span class="st">"coerce"</span>).fillna(<span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"label"</span>] <span class="op">=</span> df[<span class="st">"Udlænding?"</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'Text'</span>])</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'text'</span>] <span class="op">=</span> df[<span class="st">'Text'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.strip()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">'text'</span>] <span class="op">!=</span> <span class="st">''</span>].copy()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> Dataset.from_pandas(df[[<span class="st">"text"</span>, <span class="st">"label"</span>]])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> dataset.train_test_split(test_size<span class="op">=</span><span class="fl">0.3</span>, seed<span class="op">=</span><span class="dv">49</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> dataset[<span class="st">"train"</span>]</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> dataset[<span class="st">"test"</span>]</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SetFitModel.from_pretrained(<span class="st">"JohanHeinsen/Old_News_Segmentation_SBERT_V0.1"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_metrics(preds, labels):</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    acc <span class="op">=</span> accuracy_score(labels, preds)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> f1_score(labels, preds, average<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    precision <span class="op">=</span> precision_score(labels, preds, average<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    recall <span class="op">=</span> recall_score(labels, preds, average<span class="op">=</span><span class="st">'binary'</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"accuracy"</span>: acc, </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"f1"</span>: f1,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: precision,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall"</span>: recall</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>trainer <span class="op">=</span> SetFitTrainer(</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>model,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    train_dataset<span class="op">=</span>train_dataset,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    eval_dataset<span class="op">=</span>test_dataset,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span>compute_metrics,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">24</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    num_iterations<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    num_epochs<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    learning_rate<span class="op">=</span><span class="fl">2e-5</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>trainer.train()</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> trainer.evaluate()</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Metrics:"</span>, metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De præcise træningsparametre for de tre modeller kan ses på Huggingface. De tre modeller har følgende metrics:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Nøjagtighed</th>
<th>Præcision</th>
<th>Genkaldelse</th>
<th>F1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PE_efterlyst_appearance</td>
<td>0.9665</td>
<td>0.9702</td>
<td>0.9890</td>
<td>0.9795</td>
</tr>
<tr class="even">
<td>PE_efterlyst_foreigner</td>
<td>0.9688</td>
<td>0.8545</td>
<td>0.8868</td>
<td>0.8704</td>
</tr>
<tr class="odd">
<td>PE_efterlyst_gender</td>
<td>0.98</td>
<td>0.9437</td>
<td>0.9306</td>
<td>0.9371</td>
</tr>
</tbody>
</table>
<p>Det lykkedes os ikke at træne tilfredsstillende modeller til at identificere henholdsvis bekymrede efterlysninger eller fremlysninger, givetvis fordi der var så få af dem.</p>
<p>Modellerne blev uploadet til Huggingface og er derefter kørt en for en sådan her:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> setfit <span class="im">import</span> SetFitModel</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SetFitModel.from_pretrained(<span class="st">"JohanHeinsen/PE_efterlyst_gender"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">'Efterlysninger_fra_PE.xlsx'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>texts <span class="op">=</span> df[<span class="st">'Text'</span>].tolist()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> model.predict_proba(texts)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>female_prop <span class="op">=</span> probs[:, <span class="dv">1</span>]</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'female_prop'</span>] <span class="op">=</span> female_prop</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>df.to_csv(<span class="st">'Predictions_with_female.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vi loader resultaterne ind i R for at se på, hvordan mønstrene udvikler sig over tid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_classes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Predictions_with_female_foreigner_appearance.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(seneste_overskrift, <span class="st">"lysning|eddelelse"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(seneste_overskrift, <span class="st">"(A|a)flys"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df_classes_year <span class="ot">&lt;-</span> df_classes <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(å<span class="at">r =</span> <span class="fu">year</span>(dato)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(år) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kvinde =</span> <span class="fu">mean</span>(female_prop),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            udlænding <span class="ot">=</span> <span class="fu">mean</span>(foreigner_prop),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">signalement =</span> <span class="fu">mean</span>(apperance_prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(kvinde, udlænding, signalement), <span class="at">values_to =</span> <span class="st">"relativ_forekomst"</span>, <span class="at">names_to =</span> <span class="st">"omtaler"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_classes_year) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> år, <span class="at">y =</span> relativ_forekomst, <span class="at">colour =</span> omtaler))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="billedfiler/Skærmbillede%202025-11-05%20kl.%2019.46.11.png" class="img-fluid"></p>
<p>Det undrede os, at alle tre kategorier falder over perioden. Det relative fald er størst for de to små kategorier, men vi ser også, at andelen af efterlysninger med signalement falder. Det har vi brug for at undersøge nærmere. Og for at gøre det, har vi brug for at krydse kategorierne med andre datapunkter - f.eks. klyngerne fra vores umap.</p>
</section>
<section id="kategorisering-med-blandet-workflow" class="level2">
<h2 class="anchored" data-anchor-id="kategorisering-med-blandet-workflow">Kategorisering med blandet workflow</h2>
<p>Vi skaber derfor kategorier på baggrund af output fra vores setfit modeller, regulære udtryk og de clusters vi fandt via hdbscan på vores umap af paragraph2vec. De regulære søgeudtryk er informeret om de slægtskaber vi kunne se igennem vores word2vec. F.eks. har vi tjekket denne efter ord associeret med “løsgænger” og fundet en række andre ord, der kunne være indikatorer på, at personen stod udenfor arbejdsmarkedet.</p>
<p>De tags vi skaber i denne proces må forstås som informerede forslag. Målet er at få måder at opdele materialet for at se bredere mønstre. Vi accepterer med andre ord, at der kan være fejl.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>clusters_annoteret <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"clusters_annoteret_fix.xlsx"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>clusters)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df_classes_2 <span class="ot">&lt;-</span> df_classes <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(clusters_annoteret)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df_classes_3 <span class="ot">&lt;-</span> df_classes_2 <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">papir =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(<span class="fu">str_to_lower</span>(Text), <span class="st">"tvangspas|skudsmaal|vandreb|legitimation| pas |opholdsbog|papirer|re(i|j)sebog|døbeattest|re(i|j)sepas|søfartsbog"</span>) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"omtale af dokumentationspapirer"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    løsgænger <span class="ot">=</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(<span class="fu">str_to_lower</span>(Text), <span class="st">"løsgænger|vagabond|driver|stre(i|j)fe|omflakke|tigge|betle|arbejdsløs|erhvervsløs"</span>) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"arbejdsløshed"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    død <span class="ot">=</span> <span class="fu">case_when</span>(tags <span class="sc">==</span> <span class="st">"afdøde"</span> <span class="sc">~</span> <span class="st">"afdøde"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    bøde <span class="ot">=</span> <span class="fu">case_when</span>((tags <span class="sc">==</span> <span class="st">"skyldnere"</span> <span class="sc">|</span> tags <span class="sc">==</span> <span class="st">"bøder"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(<span class="fu">str_to_lower</span>(Text), <span class="st">"bøde|alimentation|alimentant|mulkt|underholdningsbidrag|forsørgelsessag|paternitet|nddrivelse|ndfordring|skilsmisse|gjæld"</span>) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"skyldner"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fattig =</span> <span class="fu">case_when</span>(tags <span class="sc">==</span> <span class="st">"sociale omstændigheder"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(<span class="fu">str_to_lower</span>(Text), <span class="st">"fattig|subsistens|arbe(i|j)jds(ans|hus)"</span>) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"omtale af sociale omstændigheder"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigtelse =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(<span class="fu">str_to_lower</span>(Text), <span class="st">"sigte"</span>) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"sigtelse for forbrydelse"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">kvinde =</span> <span class="fu">case_when</span>(female_prop <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"omtale af kvinde"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    udlænding <span class="ot">=</span> <span class="fu">case_when</span>(foreigner_prop <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"omtale af udlænding"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">signalement =</span> <span class="fu">case_when</span>(apperance_prop <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"signalement"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bekymring =</span> <span class="fu">case_when</span>(tags <span class="sc">==</span> <span class="st">"bekymring for den efterlyste"</span> <span class="sc">~</span> <span class="st">"bekymring for den efterlyste"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    militær <span class="ot">=</span> <span class="fu">case_when</span>(tags <span class="sc">==</span> <span class="st">"militær"</span> <span class="sc">|</span> tags <span class="sc">==</span> <span class="st">"værnepligt"</span> <span class="sc">~</span> <span class="st">"militær tilknytning"</span>, <span class="at">.default =</span> <span class="cn">NA</span>),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    opfølgning <span class="ot">=</span> <span class="fu">case_when</span>(tags <span class="sc">==</span> <span class="st">"opfølgning"</span> <span class="sc">~</span> <span class="st">"opfølgning"</span>, <span class="at">.default =</span> <span class="cn">NA</span>))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>df_tag_frame <span class="ot">&lt;-</span> df_classes_3 <span class="sc">%&gt;%</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(papir, løsgænger, død, bøde, fattig, sigtelse, kvinde, udlænding, signalement, bekymring, militær, opfølgning)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>df_tag_frame<span class="sc">$</span>samlede_tags <span class="ot">&lt;-</span> <span class="fu">apply</span>(df_tag_frame, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">paste</span>(<span class="fu">na.omit</span>(x), <span class="at">collapse =</span> <span class="st">"; "</span>))</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>df_tag_frame_total <span class="ot">&lt;-</span> df_tag_frame <span class="sc">%&gt;%</span> <span class="fu">select</span>(samlede_tags)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>df_opdateret <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>text) <span class="sc">%&gt;%</span> </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(df_tag_frame_total)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>df_tag_frame_2 <span class="ot">&lt;-</span> df_tag_frame <span class="sc">%&gt;%</span> </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>samlede_tags) <span class="sc">%&gt;%</span> </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(.) <span class="sc">&amp;</span> . <span class="sc">!=</span> <span class="st">""</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>korrelationer <span class="ot">&lt;-</span> <span class="fu">cor</span>(df_tag_frame_2) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tabellen over korrelationer ser sådan ud:</p>
<p><img src="images/Skærmbillede%202025-11-06%20kl.%2009.53.53.png" class="img-fluid"></p>
<p>Det er tydeligt, at der er en negativ sammenhæng imellem signalement og bestemte kategorier, især militær og skyldnere. Vi ser også, at der er en svag positiv korrelation imellem omtale af dokumentation og både de arbejdsløse og udlændinge. Det kunne indikere at spørgsmålet om dokumentation især handler om bestemte grupper, der stadig er pålagt kravet om personlig dokumentation under bevægelse - et levn fra Enevælden.</p>
<p>Lad os tjekke kvaliteten af vores klassifikation ved at kigge på en kategori.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_tjek <span class="ot">&lt;-</span> df_opdateret <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(samlede_tags, <span class="st">"skyldner"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">8</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>df_tjek<span class="sc">$</span>Text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1] "4) Tjenestekarl Niels Johannessen, f. i Steenmagle, den 19. October 1834, bedes i Antræffelsestilfælde, affordret en Bøde af 20 Kr. til Merløse-TudseHerreders Politikasse og i Mangel af Betaling, hensat til Afsoning af samme til simp. Fængsel i 5 Dage efter Holbæk Amts Resolution af 4. f. M. Han forlod den 1. Novbr. f. A. Egholm i HornsHerred, uden at der senere er oplyst noget om hans Opholdsted. Underretning bedes meddelt Merløse-Tudse Herreders Kontor i Holbæk. Det er en simpel og brutal Person, der ligge fra Foraaret 1878, ved at flytte hemmeligt fra Sted til Sted, har søgt at unddrage sig Ansvar."
[2] "2) J Anledning af Alimentationsbidrags Jnddrivelse beder Herredsfogden i Sunds-Gudme Herreder sig meddelt Oplysning om, hvor Tjenestekarl Jens Jørgensen for Tiden opholder Han tjente indtil 1. Maj paa Gammel Klingstrup i Skaarup Sogn."                                                                                                                                                                                                                                                                                                                                                                                      
[3] "5) Da Tjenestekarl Jens Peter Ottesen af Gierninge ikke har betalt en den 1ste f. M. forfalden Mulkt til de Fattiges Kasse i Kornerup Sogn, stor 10 Rd., og hans Opholdsted ikke kjendes, bedes i Antræffelsestilfælde Mulk. ten i Henhold til Dekret fra Sjællands Stiftamt af 23de f. M. foranstaltet afsonet med simpelt Fængsel i 5 Dage og Underretning meddelt Herredsfogden i Lejre Hørred."                                                                                                                                                                                                                              
[4] "2) J Anledning af Jndfordring af et Alimentationsbidrag beder By- og Herredsfogden Kjøge søgt Oplysning om Arbejdsmand Jens Jacobsens Opholdsted. Han har sidst havt Bopæl i Kjøbenhavn, Badeveien 13."                                                                                                                                                                                                                                                                                                                                                                                                                          
[5] "4) Garversvend Maximilian Petersen skylder til Aalborg Kjøbstads Politikasse en Bøde af Kroner, hvilken han ifølge Aalborg Stiftamts Resolution af 25 April 1882 er tilpligtet at afsone med simpel Fængsel i 2 Dage. Han er den 14. Juni f. A. viseret fra Kjøge til Storehedinge, hvilken By han har forladt den paafølgende Dag, efterladende sin Vandrebog paa Byfogdekontoret. Oplysning om hans Opholdsted bedes meddelt Byfogden i Aalborg."                                                                                                                                                                              
[6] "7) Oplysning om forhenv. Sporvognskusk ved Kbhvn.s Sporvejsselskab, senere Vognmandskusk, Jens Nielsens Opholdsted udbedes i Anledning. af en Skilsmissesag. Han har formentl. Tjeneste i Hirschholm el. Frederiksborg Birk. (H. St.)"                                                                                                                                                                                                                                                                                                                                                                                           
[7] "3) Herredsfogden i Børglum Herred udbedes sig meddelt Oplysning om Møllersvend Anders Christian Svendsens Opholdsted for at et forfaldent Alimentationsbidrag kan blive inddrevet hos ham, Fra 1. April til Slutningen. af forrige Maaned eller til Begyndelsen af denne Maaned arbejdede han hos Møller Heyndorf i Terslev Sogn under Bregentved-Gisselfeld, Birkers Jurisdiktion, hvilket Opholdsted han imidlertid forlod, efter Udpantningsordrens Forkyndelse."                                                                                                                                                             
[8] "1) En Person, der har kaldet sig Alfred Hjermind fra Odense, har den 19. Ds. hemmelig forladt Hotel du Nord i Hjørring, efterladende sien Gjæld paa 8 Kr. 5 Øre. Hans Signalement er opgivet saaledes: 36 a 38 Aar gl., middelhøj, tyndt lyst Haar, blondt Kindskjæg og velklædt, I Antræffelsestilfælde bedes han affordret det ovennævnte Beløb og i Mangel af Betaling anholdt samt Underretning meddelt Byfogden i Hjørring."  </code></pre>
<p>Metoden vi har anlagt betyder, at vi må forvente, at kategorierne i alle tilfælde vil indeholde både falske positive (f.eks. fordi et indikativt ord bruges i en tekst, men ikke i den forstand, det tænkes her). Samtidig vil der også være falske negativer, f.eks. fordi vores clustering-proces (som indikeret af visualiseringerne) efterlader en del materiale uden tilhør til klynger eller fordi vores setfit-modeller ikke har kunnet fange outliers.</p>
<p>Alligevel kan vi begynde at se mønstre. F.eks. i forhold til, hvilke folk, der faktisk ikke beskrives. De falder typisk i en af de tre kategorier: “skyldner”, “militær” eller “opfølgning” - hvor sidstnævnte indeholder opfølgende oplysninger om personer, der tidligere er efterlyst, men hvor der trykkes en ny tekst, der bidrager med senere indkomne oplysninger. Det ser ud til, at det er disse tre - signalementsløse - kategorier, der skaber det mønster, vi tidligere identificerede i forhold til den dalende andel af efterlysninger med signalementer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_opdateret <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hit1 =</span> <span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(samlede_tags, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"signalement"</span>)),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">hit2 =</span> <span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(samlede_tags, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"skyldner|militær|opfølgning"</span>)),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>         å<span class="at">r =</span> <span class="fu">year</span>(dato)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(år) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hit1_average =</span> <span class="fu">mean</span>(hit1),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">hit2_average =</span> <span class="fu">mean</span>(hit2)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> år, <span class="at">y =</span> hit1_average), <span class="at">colour =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> år, <span class="at">y =</span> hit2_average), <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">y =</span> <span class="fl">0.75</span>, <span class="at">x =</span> <span class="dv">1880</span>, <span class="at">label =</span> <span class="st">"Signalement"</span>, <span class="at">colour =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">y =</span> <span class="fl">0.27</span>, <span class="at">x =</span> <span class="dv">1881</span>, <span class="at">label =</span> <span class="st">"militære, skyldnere og opfølgninger"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"andel af efterlysninger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Skærmbillede%202025-11-06%20kl.%2017.43.46.png" class="img-fluid"></p>
<p>Dermed har vi fået indsnævret, hvad der op og ned i dette mønster. Der handler primært om nogle bestemte grupper, typisk mænd, der har en systematisk tilstedeværelse i materialet, men beskrives uden at beskrive deres kroppe og fremtoning.</p>
<p>På en måde overrasker det. Litteraturen fortæller os, at politiets greb om befolkningen handler om deres kroppe. Dette er perioden for det “biometriske” politi og det “standardiserede blik”. Disse efterlysninger er hverken rettet imod kroppen eller specielt standardiserede. Men politiet har tilsyneladende ikke brug for kropsbeskrivelsen for at identificere disse mennesker - måske fordi de formodes ikke at bevæge sig under falske navne? Eller fordi man forestiller sig, at de før eller siden dukker op igen på steder, hvor det lokale politi allerede kender dem?</p>
<p>Hvordan ser det ud med udviklingen i statens pasdokumentation?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_opdateret <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hit1 =</span> <span class="fu">as.numeric</span>(<span class="fu">str_detect</span>(samlede_tags, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"dokumentation"</span>)),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         å<span class="at">r =</span> <span class="fu">year</span>(dato)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(år) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hit1_average =</span> <span class="fu">mean</span>(hit1)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> år, <span class="at">y =</span> hit1_average), <span class="at">colour =</span> <span class="st">"forestgreen"</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"andel af efterlysninger"</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Annoncer med omtale af legitimationspapirer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Skærmbillede%202025-11-06%20kl.%2009.57.49.png" class="img-fluid"></p>
<p>Bemærk, at det er relativt få annoncer, der omtaler legitimationspapirer, men mønsteret er relativt stabilt henover perioden, med en svagt nedadgående tendens imod slutning. Sidstnævnte kunne hænge sammen med den overordet set mindre andel af efterlysninger, der handler om udlændinge fra sidste del af perioden.</p>
<p>Dette overrasker måske også. Dette er perioden, hvor mobiliteten kanonisk er givet fri - og før det internationale passystem dukker op i starten af det 20. århundrede, der fikserer mobiliteten om de eksterne grænser. Alligevel optræder forskellige dokumentationsformer i materialet - som elementer der kan guide identifikation.</p>
</section>
<section id="eksport" class="level2">
<h2 class="anchored" data-anchor-id="eksport">Eksport</h2>
<p>Vi gemmer til sidst vores taggede datasæt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_opdateret <span class="sc">%&gt;%</span> <span class="fu">write.csv</span>(<span class="st">"Efterlysninger_med_tags.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df_opdateret_tjek <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Efterlysninger_med_tags.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>